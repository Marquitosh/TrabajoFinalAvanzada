@model List<AvanzadaWeb.ViewModels.TipoServicioViewModel>

@{
    ViewData["Title"] = "Solicitud de Servicios";
    Layout = "_UserLayout";
}

<div class="row">
    <span> Daniel Vinet </span>
    <div class="col-md-12">
        <h2 class="mb-4">Solicitud de Servicios</h2>

        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
        {
            <div class="alert alert-danger">@ViewBag.ErrorMessage</div>
        }

        <div class="card">
            <div class="card-body">
                <form id="servicesForm">
                    <ul class="list-group mb-3">

                        @if (Model != null && Model.Any())
                        {
                            @foreach (var servicio in Model)
                            {
                                <li class="list-group-item d-flex align-items-center">
                                    <input class="form-check-input me-2 service-checkbox" type="checkbox" value="@servicio.IdTipoServicio" data-nombre="@servicio.Nombre" />
                                    <span>@servicio.Nombre</span>

                                </li>
                            }
                        }
                        else if (string.IsNullOrEmpty(ViewBag.ErrorMessage))
                        {
                            <li class="list-group-item">No hay servicios disponibles en este momento.</li>
                        }

                    </ul>

                    <button type="submit" id="btnAgendar" class="btn btn-primary" disabled>
                        <i class="bi bi-calendar-plus"></i> Agendar Turno
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const checkboxes = document.querySelectorAll(".service-checkbox");
            const btnAgendar = document.getElementById("btnAgendar");

            checkboxes.forEach(chk => {
                chk.addEventListener("change", () => {
                    const selected = Array.from(checkboxes).some(c => c.checked);
                    btnAgendar.disabled = !selected;
                });
            });

            document.getElementById("servicesForm").addEventListener("submit", function (e) {
                e.preventDefault();

                const selectedServices = Array.from(checkboxes)
                    .filter(c => c.checked)
                    .map(c => c.value);

                // Redirigir a la página de Agendar Turno pasando los servicios seleccionados
                const query = selectedServices.map(id => "ids=" + id).join("&");
                window.location.href = "/Usuarios/ScheduleAppointment?" + query;
            });
        });
    </script>
}
